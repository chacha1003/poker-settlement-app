<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>è»Šè»Šå¾·å·å°å·¥å…· beta</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #1b1b1b;
      color: #ffffff;
      margin: 0;
      padding: 20px;
      font-size: 18px;
    }
    .container {
      max-width: 900px;
      margin: auto;
      text-align: center;
    }
    h1 {
      margin-bottom: 10px;
    }
    .header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      font-weight: bold;
    }
    .button {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      margin: 5px;
    }
    input, select {
      padding: 10px;
      margin: 5px;
      font-size: 16px;
      border-radius: 4px;
      border: none;
    }
    .player-list {
      margin-top: 20px;
      text-align: left;
    }
    .player {
      display: flex;
      align-items: center;
      background-color: #2b2b2b;
      border-radius: 8px;
      padding: 10px;
      margin-bottom: 10px;
    }
    .avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      margin-right: 10px;
      border: 2px solid #fff;
    }
    .player-info {
      flex-grow: 1;
    }
    .player-name {
      font-size: 20px;
      font-weight: bold;
      color: #ff66cc;
    }
    .player-detail {
      font-size: 16px;
      color: #ffd700;
    }
    .history-record, .ranking, .settlement-detail {
      background-color: #2a2a2a;
      padding: 15px;
      border-radius: 10px;
      margin-top: 30px;
    }
    .rank-item {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-bottom: 10px;
    }
    .rank-name {
      font-weight: bold;
      color: #00e6e6;
      font-size: 18px;
    }
    .rank-amount {
      font-weight: bold;
      font-size: 18px;
    }
    .rank-comment {
      font-style: italic;
      color: #ccc;
      margin-left: 8px;
    }
  </style>
</head>
<body>
<div class="container">
  
    <div style="text-align: center;">
      <h1 style="margin-bottom: 0;">è»Šè»Šå¾·å·å°å·¥å…·</h1>
      <div style="font-size: 16px; color: #888;">beta</div>
    </div>
    
<div style="font-size: 14px; color: #888; margin-top: 20px; text-align: center;">
  ğŸ“Œ æ¸©é¦¨æç¤ºï¼šæœ¬å·¥å…·ä»…ä¾›å¨±ä¹å‚è€ƒï¼Œç¦æ­¢ç”¨äºä»»ä½•å½¢å¼çš„èµŒåšæˆ–éæ³•æ´»åŠ¨ã€‚<br>
  æœ¬ç½‘é¡µä½œè€…ä¸å‚ä¸ä»»ä½•é‡‘é’±äº¤æ˜“ï¼Œä»…æä¾›å¾·å·æ‰‘å…‹ç»“ç®—è¾…åŠ©åŠŸèƒ½ï¼Œç”¨äºäº²å‹é—´çº¿ä¸‹å¨±ä¹ã€‚<br>
  ä½¿ç”¨æœ¬å·¥å…·å³è¡¨ç¤ºæ‚¨å·²çŸ¥æ‚‰å¹¶åŒæ„åˆæ³•ã€åˆè§„ä½¿ç”¨æœ¬ç¨‹åºã€‚<br>
  Â© 2025 æœ¬ç½‘é¡µä½œè€…ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚
</div>

  <div class="header">
    <div id="total-chips">æ€»ç­¹ç : 0</div>
    <div id="total-players">å‚ä¸ç©å®¶: 0</div>
  </div>
  <div>
    <label>1å…ƒ = <input type="number" inputmode="numeric" pattern="[0-9]*" step="1" inputmode="numeric" pattern="[0-9]*" step="1" id="chip-rate" value="10" /> ç­¹ç </label>
    <button class="button" onclick="updateChipRate()">æ›´æ–°æ¯”ç‡</button>
    <div id="rate-msg" style="color: lightgreen; display: none;">æ¯”ç‡æ›´æ–°æˆåŠŸï¼</div>
  </div>
  <div>
    <input type="text" id="player-name" placeholder="ç©å®¶å§“å" />
    <button class="button" onclick="addPlayer()">æ·»åŠ ç©å®¶</button>
  </div>
  <div>
    <select id="player-select"></select>
    <input type="number" inputmode="numeric" pattern="[0-9]*" step="1" inputmode="numeric" pattern="[0-9]*" step="1" id="buy-amount" placeholder="ä¹°å…¥é‡‘é¢(å…ƒ)" />
    <button class="button" onclick="buyChips()">ä¸ºç©å®¶ä¹°å…¥</button>
    <button class="button" onclick="buyForAll()">å…¨ä½“ç©å®¶ä¹°å…¥</button>
  </div>
  <div class="player-list" id="player-list"></div>
  <div class="history-record">
    <h3>å†å²ä¹°å…¥è®°å½•</h3>
    <table id="buy-history-table" style="width: 100%; color: #fff;">
      <thead>
        <tr><th>æ—¶é—´</th><th>ç©å®¶</th><th>é‡‘é¢</th><th>ç­¹ç </th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <div class="history-record">
    <h3>ç»“ç®—</h3>
    <div style="color: #aaa; font-size: 14px; margin-bottom: 10px;">è¯·å¡«å…¥æ¯ä½ç©å®¶å½“å‰å‰©ä½™çš„ç­¹ç æ•°é‡</div>
    <div id="player-chips-inputs"></div>
    
  <div style="margin-top: 20px;">
    <label><input type="checkbox" id="enable-water" onchange="toggleWater()" /> å¯ç”¨æŠ½æ°´</label>
    <input type="number" inputmode="numeric" pattern="[0-9]*" step="1" inputmode="numeric" pattern="[0-9]*" step="1" id="water-percent" value="10" style="width: 60px;" disabled />%
  </div>

    <button class="button" onclick="calculateSettlement()">ç»“ç®—</button>
    <div id="settlement-result"></div>
  </div>
  <div class="ranking" id="ranking"></div>
  <div class="settlement-detail" id="settlement-detail"></div>
</div>
<script>
let players = [];
let chipRate = 10;
let buyHistory = [];
function updateChipRate() {
  const val = parseInt(document.getElementById('chip-rate').value);
  if (val > 0) chipRate = val;
  const msg = document.getElementById('rate-msg');
  msg.style.display = 'block';
  setTimeout(() => msg.style.display = 'none', 2000);
}
function formatId(id) {
  return id.toString().padStart(3, '0');
}
function getAvatar(name) {
  return `https://api.dicebear.com/7.x/bottts-neutral/svg?seed=${encodeURIComponent(name)}`;
}
function addPlayer() {
  const name = document.getElementById('player-name').value.trim();
  if (!name) return;
  players.push({ id: players.length + 1, name, totalBuyIn: 0, chips: 0, buyRecords: [] });
  updateUI();
  document.getElementById('player-name').value = '';
}
function deletePlayer(id) {
  players = players.filter(p => p.id !== id);
  players.forEach((p, i) => p.id = i + 1);
  updateUI();
}
function buyChips() {
  const id = parseInt(document.getElementById('player-select').value);
  const amountInput = document.getElementById('buy-amount');
  const amount = parseInt(amountInput.value);
  if (!amountInput.value || isNaN(amount) || amount <= 0) return;
  if (!id) return;
  const p = players.find(p => p.id === id);
  p.totalBuyIn += amount;
  p.chips += amount * chipRate;
  p.buyRecords.push({ amount, chips: amount * chipRate });
  buyHistory.push({ time: new Date().toLocaleTimeString(), name: p.name, amount, chips: amount * chipRate });
  updateUI();
}
function buyForAll() {
  const amountInput = document.getElementById('buy-amount');
  const amount = parseInt(amountInput.value);
  if (!amountInput.value || isNaN(amount) || amount <= 0) return;
  players.forEach(p => {
    p.totalBuyIn += amount;
    p.chips += amount * chipRate;
    p.buyRecords.push({ amount, chips: amount * chipRate });
    buyHistory.push({ time: new Date().toLocaleTimeString(), name: p.name, amount, chips: amount * chipRate });
  });
  updateUI();
}
function withdrawLast(id) {
  const p = players.find(p => p.id === id);
  const last = p.buyRecords.pop();
  if (!last) return;
  p.totalBuyIn -= last.amount;
  p.chips -= last.chips;
  buyHistory = buyHistory.filter(h => !(h.name === p.name && h.amount === last.amount && h.chips === last.chips));
  updateUI();
}
function updateUI() {
  const playerSelect = document.getElementById('player-select');
  const currentValue = playerSelect.value;
  document.getElementById('player-list').innerHTML = players.map(p => `
    <div class="player">
      <img class="avatar" src="${getAvatar(p.name)}">
      <div class="player-info">
        <div class="player-name">${formatId(p.id)}. ${p.name}</div>
        <div class="player-detail">ä¹°å…¥: <strong style="color:#00e6e6;font-size:18px;">${p.totalBuyIn}å…ƒ</strong> ç­¹ç  <strong style="color:#ffd700;font-size:18px;">${p.chips} ğŸ’</strong></div>
        <button class="button" onclick="withdrawLast(${p.id})">æ’¤å›ä¹°å…¥</button>
        <button class="button" onclick="deletePlayer(${p.id})">åˆ é™¤</button>
      </div>
    </div>
  `).join('');
  playerSelect.innerHTML = players.map(p => `
    <option value="${p.id}">${p.name}</option>
  `).join('');
  playerSelect.value = currentValue;
  document.getElementById('buy-history-table').querySelector('tbody').innerHTML = buyHistory.map(h => `
    <tr><td>${h.time}</td><td>${h.name}</td><td>${h.amount}</td><td>${h.chips}</td></tr>
  `).join('');
  document.getElementById('player-chips-inputs').innerHTML = players.map(p => `
    <div style="margin: 5px;">
      ${p.name}: <input type="number" inputmode="numeric" pattern="[0-9]*" step="1" inputmode="numeric" pattern="[0-9]*" step="1" id="chips-${p.id}" value="0">
    </div>
  `).join('');
  document.getElementById('total-chips').innerText = `æ€»ç­¹ç : ${players.reduce((s, p) => s + p.chips, 0)}`;
  document.getElementById('total-players').innerText = `å‚ä¸ç©å®¶: ${players.length}`;
}
function calculateSettlement() {
  const results = players.map(p => {
    const rawInput = document.getElementById(`chips-${p.id}`);
const match = rawInput.value.match(/\d+/g);
const clean = match ? match.join('') : '0';
rawInput.value = clean;
const remain = parseInt(clean);
    const buyYuan = p.totalBuyIn;
    const winChips = remain - buyYuan * chipRate;
    const winYuan = winChips / chipRate;
    return {
      name: p.name,
      avatar: getAvatar(p.name),
      win: winYuan,
      buyChips: buyYuan * chipRate,
      remainChips: remain,
      buyAmount: buyYuan,
      water: (document.getElementById('enable-water').checked && winYuan > 0 ? winYuan * (parseFloat(document.getElementById('water-percent').value) / 100) : 0),
      transferAmount: buyYuan + winYuan - (document.getElementById('enable-water').checked && winYuan > 0 ? winYuan * (parseFloat(document.getElementById('water-percent').value) / 100) : 0)
    };
  });
  const sorted = [...results].sort((a, b) => b.win - a.win);
  const winComments = ["ä»Šæ™š MVP ğŸ¥‡", "èººç€èµ¢ ğŸ˜", "æ°´ä¸Šæ¼‚ ğŸ€", "èµ¢éº»äº† ğŸ¤‘", "æŠŠæŠŠå¤§ç‰Œ ğŸš€"];
  const evenComments = ["åˆšå¥½å›æœ¬ ğŸ¯", "ç®—ä½ ç¨³ ğŸ§˜â€â™‚ï¸"];
  const loseComments = ["æƒ¨æ¡ˆå»ºè®®æŠ¥è­¦ ğŸš¨", "è¡€äºç‹è€… ğŸ’€", "ä»Šæ™šåƒåœŸ ğŸ§±", "å¤ªéš¾äº† ğŸ˜©", "é”…ç”©ä¸æ‰ ğŸ’"];
  const rankingHtml = sorted.map((r, i) => {
    let comment = "";
    if (r.win > 0) comment = winComments[i] || "èµ¢äº†ï¼ğŸ¥³";
    else if (r.win < 0) comment = loseComments[i] || "ä¸‹æ¬¡ç¿»èº«ï¼ğŸ’ª";
    else comment = evenComments[i] || "å¹³ç¨³è½åœ°ï¼ğŸ›¬";
    return `
      <div class="rank-item">
        <img class="avatar" src="${r.avatar}" style="width: 40px; height: 40px">
        <span class="rank-name">${r.name}</span>
        <span class="rank-amount" style="color:${r.win >= 0 ? 'lightgreen' : 'tomato'}">${r.win.toFixed(2)} å…ƒ</span>
        <span class="rank-comment">${comment}</span>
      </div>`;
  }).join('');
  document.getElementById('ranking').innerHTML = '<h3>è¾“èµ¢æ’è¡Œæ¦œ</h3>' + rankingHtml;

  const detailHtml = results.map(r => `
    <div style="margin: 6px 0;">
      ${r.name}ï¼šä¹°å…¥é‡‘é¢ ${r.buyAmount} å…ƒï¼Œä¹°å…¥ç­¹ç  ${r.buyChips}ï¼Œå‰©ä½™ç­¹ç  ${r.remainChips}ï¼Œç›ˆäº <strong style="color:${r.win >= 0 ? 'lightgreen' : 'tomato'}">${r.win.toFixed(2)} å…ƒ</strong><br>
      æŠ½æ°´é‡‘é¢ï¼š<strong style='color:orange'>${r.water.toFixed(2)} å…ƒ</strong><br>
      å±€å¤´åº”è½¬ï¼š<strong>${r.transferAmount.toFixed(2)} å…ƒ</strong>
    </div>
  `).join('');
  document.getElementById('settlement-detail').innerHTML = '<h3>ç»“ç®—æ±‡æ€»æ˜ç»†</h3>' + detailHtml;

  const totalBuyChips = results.reduce((sum, r) => sum + r.buyChips, 0);
  const totalRemainChips = results.reduce((sum, r) => sum + r.remainChips, 0);
  let resultInfo = `<div style='margin-top: 10px;'>æ€»ä¹°å…¥ç­¹ç ï¼š${totalBuyChips}ï¼Œç»“ç®—ç­¹ç æ€»æ•°ï¼š${totalRemainChips}</div>`;
  if (totalBuyChips !== totalRemainChips) {
    const diff = Math.abs(totalBuyChips - totalRemainChips);
    resultInfo += `<div style='color:red;font-weight:bold;'>åè´¦è­¦å‘Šï¼å·®é¢ï¼š${diff} ç­¹ç ï¼ˆçº¦ ${(diff / chipRate).toFixed(2)} å…ƒï¼‰</div>`;
  }
  document.getElementById('settlement-result').innerHTML = resultInfo;
}

function toggleWater() {
  const enabled = document.getElementById("enable-water").checked;
  document.getElementById("water-percent").disabled = !enabled;
}

</script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('input[type=number]').forEach(input => {
    input.addEventListener('keydown', function(e) {
      if (['-', '+', 'e', 'E', '.'].includes(e.key)) {
        e.preventDefault();
      }
    });
  });
});
</script>
</body>

</html>